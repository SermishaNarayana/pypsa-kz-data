# SPDX-FileCopyrightText:  PyPSA-Earth and PyPSA-Eur Authors
#
# SPDX-License-Identifier: CC0-1.0


tutorial: false

run:
  name: "kz_test" # use this to keep track of runs with different settings
  shared_cutouts: true  # set to true to share the default cutout(s) across runs
                        # Note: value false requires build_cutout to be enabled

scenario:
  ll: ['v1.0']
  clusters: [14]
  opts: [RES0.2-1H]


countries: ["KZ"]

snapshots:
  start: "2013-01-01"
  end: "2013-01-02"


enable:
  build_natura_raster: false  # If True, than an exclusion raster will be build


retrieve_databundle: # required to be "false" for nice CI test output
  show_progress: false # show (true) or do not show (false) the progress bar in retrieve_databundle while downloading data


custom_rules: ["pypsa-kz-data/kz.smk"]


cluster_options:
  simplify_network:
    p_threshold_drop_isolated: 10 # [MW] isolated buses are being discarded if bus mean power is below the specified threshold

  alternative_clustering: true #false  # "False" use Voronoi shapes, "True" use GADM shapes


build_shape_options:
  nprocesses: 1  # number of processes to be used in build_shapes
  nchunks: 3  # number of data chuncks for build_shapes. If not specified or smaller than nprocesses, specified as nprocesses


load_options:
  rescale_demand: true
  external_loads: true # true - adds external load buses based on data/custom_data/electricity_exp-imp.csv

electricity:
  base_voltage: 500.
  voltages: [110., 220., 500.]
  co2limit: 7.75e+11  # European default, 0.05 * 3.1e9*0.5, needs to be adjusted for Africa
  co2base: 3.17e+8  # Kazakhstan default for 1990


  extendable_carriers:
    Generator: [solar, onwind, offwind-ac, offwind-dc]  


  custom_powerplants: replace #merge #replace # "false" - no custom powerplants, "merge" use both open source and custom powerplants, "replace" use only custom powerplants


  estimate_renewable_capacities:
    stats: False #'irena'  # False, = greenfield expansion, 'irena' uses IRENA stats to add expansion limits


lines:
  types:
    220.: "490-AL1/64-ST1A 220.0"             #"Al/St 240/40 2-bundle 220.0"
    110.: "243-AL1/39-ST1A 110.0"             #"Al/St 240/40 3-bundle 300.0"
    500.: "Al/St 240/40 4-bundle 380.0"       #"Al/St 560/50 4-bundle 750.0"       #

  modify_lines:
    limit_line_capacities: true # limiting line capacities
    bus_of_interest: ["KZ.1_1_AC", "KZ.9_1_AC"] # buses of interest whose lines are limited
    max_limit: 700.0 # maximum limit for s_nom


atlite:
  nprocesses: 4
  cutouts:
    # geographical bounds automatically determined from countries input
    asia-2013-era5:
      module: era5
      dx: 0.3  # cutout resolution
      dy: 0.3  # cutout resolution


renewable:
  onwind:
    cutout: asia-2013-era5
    # resource:
    #   method: wind
    #   turbine: Vestas_V112_3MW
    # capacity_per_sqkm: 3 # conservative, ScholzPhd Tab 4.3.1: 10MW/km^2
    # # correction_factor: 0.93
    # copernicus:
    #   # Scholz, Y. (2012). Renewable energy based electricity supply at low costs:
    #   #  development of the REMix model and application for Europe. ( p.42 / p.28)
    #   # CLC grid codes:
    #   # 11X/12X - Various forest types
    #   # 20  - Shrubs
    #   # 30  - Herbaceus vegetation
    #   # 40  - Cropland
    #   # 50  - Urban
    #   # 60  - Bare / Sparse vegetation
    #   # 80  - Permanent water bodies
    #   # 100 - Moss and lichen
    #   # 200 - Open sea
    #   grid_codes: [20, 30, 40, 60, 100, 111, 112, 113, 114, 115, 116, 121, 122, 123, 124, 125, 126]
    #   distance: 1000
    #   distance_grid_codes: [50]
    # natura: true
    # potential: simple # or conservative
    # clip_p_max_pu: 1.e-2
    # extendable: true
  offwind-ac:
    cutout: asia-2013-era5
    # resource:
    #   method: wind
    #   turbine: NREL_ReferenceTurbine_5MW_offshore
    # capacity_per_sqkm: 2
    # correction_factor: 0.8855
    # # proxy for wake losses
    # # from 10.1016/j.energy.2018.08.153
    # # until done more rigorously in #153
    # copernicus:
    #   grid_codes: [80, 200]
    # natura: true
    # max_depth: 50
    # max_shore_distance: 30000
    # potential: simple # or conservative
    # clip_p_max_pu: 1.e-2
    # extendable: true
  offwind-dc:
    cutout: asia-2013-era5
    # resource:
    #   method: wind
    #   turbine: NREL_ReferenceTurbine_5MW_offshore
    # # ScholzPhd Tab 4.3.1: 10MW/km^2
    # capacity_per_sqkm: 3
    # correction_factor: 0.8855
    # # proxy for wake losses
    # # from 10.1016/j.energy.2018.08.153
    # # until done more rigorously in #153
    # copernicus:
    #   grid_codes: [80, 200]
    # natura: true
    # max_depth: 50
    # min_shore_distance: 30000
    # potential: simple # or conservative
    # clip_p_max_pu: 1.e-2
    # extendable: true
  solar:
    cutout: asia-2013-era5
    # resource:
    #   method: pv
    #   panel: CSi
    #   orientation: latitude_optimal # will lead into optimal design
    #     # slope: 0.  # slope: 0 represent a flat panel
    #     # azimuth: 180.  # azimuth: 180 south orientation
    # capacity_per_sqkm: 4.6 # From 1.7 to 4.6 addresses issue #361
    # # Determined by comparing uncorrected area-weighted full-load hours to those
    # # published in Supplementary Data to
    # # Pietzcker, Robert Carl, et al. "Using the sun to decarbonize the power
    # # sector: The economic potential of photovoltaics and concentrating solar
    # # power." Applied Energy 135 (2014): 704-720.
    # correction_factor: 0.854337
    # copernicus:
    #   grid_codes: [20, 30, 40, 50, 60, 90, 100]
    # natura: true
    # potential: simple # or conservative
    # clip_p_max_pu: 1.e-2
    # extendable: true
  hydro:
    cutout: asia-2013-era5
    # resource:
    #   method: hydro
    #   hydrobasins: data/hydrobasins/hybas_world_lev06_v1c.shp
    #   flowspeed: 1.0  # m/s
    #   # weight_with_height: false
    #   # show_progress: true
    # carriers: [ror, PHS, hydro]
    # PHS_max_hours: 6
    # hydro_max_hours: "energy_capacity_totals_by_country"  # not active
    # clip_min_inflow: 1.0
    extendable: true
    normalization:
      method: eia #hydro_capacities  # 'hydro_capacities' to rescale country hydro production by using hydro_capacities, 'eia' to rescale by eia data, false for no rescaling
      year: 2013  # (optional) year of statistics used to rescale the runoff time series. When not provided, the weather year of the snapshots is used
    # multiplier: 1.1  # multiplier applied after the normalization of the hydro production; default 1.0

# TODO: Needs to be adjusted for Africa
costs:
  year: 2020
  # version: v0.5.0
  # rooftop_share: 0.14  # based on the potentials, assuming  (0.1 kW/m2 and 10 m2/person)
  # USD2013_to_EUR2013: 0.7532 # [EUR/USD] ECB: https://www.ecb.europa.eu/stats/exchange/eurofxref/html/eurofxref-graph-usd.en.html
  fill_values:
    # FOM: 0
    # VOM: 0
    # efficiency: 1
    # fuel: 0
    # investment: 0
    # lifetime: 25
    # CO2 intensity: 0
    discount rate: 0.15
  # marginal_cost: # EUR/MWh
  #   solar: 0.01
  #   onwind: 0.015
  #   offwind: 0.015
  #   hydro: 0.
  #   H2: 0.
  #   electrolysis: 0.
  #   fuel cell: 0.
  #   battery: 0.
  #   battery inverter: 0.
  # emission_prices: # in currency per tonne emission, only used with the option Ep
  #   co2: 0.


# monte_carlo:
#   options:
#     add_to_snakefile: false
#     samples: 7    # number of optimizations
#     sampling_strategy: "chaospy"    # "pydoe2", "chaospy", "scipy", packages that are supported
#   pypsa_standard:
#       # User can add here flexibly more features for the Monte-Carlo sampling.
#       # Given as "key: value" format
#       # Key: add below the pypsa object for the monte_carlo sampling, "network" is only allowed for filtering!
#       # Value: currently supported format [l_bound, u_bound] or empty [], represent multiplication factors for the object
#     loads_t.p_set: [0.9, 1.1]
#     generators_t.p_max_pu.loc[:, n.generators.carrier == "wind"]: [0.9, 1.1]
#     generators_t.p_max_pu.loc[:, n.generators.carrier == "solar"]: [0.9, 1.1]


# solving:
#   options:
#     formulation: kirchhoff
#     load_shedding: true
#     noisy_costs: true
#     min_iterations: 4
#     max_iterations: 6
#     clip_p_max_pu: 0.01
#     skip_iterations: true
#     track_iterations: false
# #     #nhours: 10
#   solver:
#     name: glpk


# plotting:
#   map:
#     figsize: [7, 7]
#     boundaries: [-10.2, 29, 35, 72]
#     p_nom:
#       bus_size_factor: 5.e+4
#       linewidth_factor: 3.e+3

#   costs_max: 800
#   costs_threshold: 1

#   energy_max: 15000.
#   energy_min: -10000.
#   energy_threshold: 50.

#   vre_techs: ["onwind", "offwind-ac", "offwind-dc", "solar", "ror"]
#   conv_techs: ["OCGT", "CCGT", "nuclear", "coal", "oil"]
#   storage_techs: ["hydro+PHS", "battery", "H2"]
#   load_carriers: ["AC load"]
#   AC_carriers: ["AC line", "AC transformer"]
#   link_carriers: ["DC line", "Converter AC-DC"]
#   tech_colors:
#     "onwind": "#235ebc"
#     "onshore wind": "#235ebc"
#     "offwind": "#6895dd"
#     "offwind-ac": "#6895dd"
#     "offshore wind": "#6895dd"
#     "offshore wind ac": "#6895dd"
#     "offwind-dc": "#74c6f2"
#     "offshore wind dc": "#74c6f2"
#     "hydro": "#08ad97"
#     "hydro+PHS": "#08ad97"
#     "PHS": "#08ad97"
#     "hydro reservoir": "#08ad97"
#     "hydroelectricity": "#08ad97"
#     "ror": "#4adbc8"
#     "run of river": "#4adbc8"
#     "solar": "#f9d002"
#     "solar PV": "#f9d002"
#     "solar thermal": "#ffef60"
#     "biomass": "#0c6013"
#     "solid biomass": "#06540d"
#     "biogas": "#23932d"
#     "waste": "#68896b"
#     "geothermal": "#ba91b1"
#     "OCGT": "#d35050"
#     "gas": "#d35050"
#     "natural gas": "#d35050"
#     "CCGT": "#b20101"
#     "nuclear": "#ff9000"
#     "coal": "#707070"
#     "lignite": "#9e5a01"
#     "oil": "#262626"
#     "H2": "#ea048a"
#     "hydrogen storage": "#ea048a"
#     "battery": "#b8ea04"
#     "Electric load": "#f9d002"
#     "electricity": "#f9d002"
#     "lines": "#70af1d"
#     "transmission lines": "#70af1d"
#     "AC-AC": "#70af1d"
#     "AC line": "#70af1d"
#     "links": "#8a1caf"
#     "HVDC links": "#8a1caf"
#     "DC-DC": "#8a1caf"
#     "DC link": "#8a1caf"
#     "load": "#FF0000"
#   nice_names:
#     OCGT: "Open-Cycle Gas"
#     CCGT: "Combined-Cycle Gas"
#     offwind-ac: "Offshore Wind (AC)"
#     offwind-dc: "Offshore Wind (DC)"
#     onwind: "Onshore Wind"
#     solar: "Solar"
#     PHS: "Pumped Hydro Storage"
#     hydro: "Reservoir & Dam"
#     battery: "Battery Storage"
#     H2: "Hydrogen Storage"
#     lines: "Transmission Lines"
#     ror: "Run of River"


databundles:
  # test cutout for Kazakhstan only
  bundle_cutouts_test_KZ:
    countries: [KZ]
    category: cutouts
    destination: "cutouts"
    urls:
      zenodo: https://sandbox.zenodo.org/record/1238391/files/test_cutouts_KZ.zip?download=1
    output: [cutouts/asia-2013-era5.nc]
    disable_by_opt:
      build_cutout: [all]
